<div class="card product-card h-100 shadow-sm position-relative">
  {% set img_src = product.image_url %}
  {% if img_src and not img_src.startswith('http') and not img_src.startswith('/') %}
    {% set img_src = url_for('static', filename=img_src) %}
  {% endif %}
  <img src="{{ img_src or url_for('static', filename='img/default-product.svg') }}" class="card-img-top" alt="{{ product.name }}">
  {% if current_user.is_authenticated and current_user.is_admin and not product.active %}
    <span class="badge bg-secondary position-absolute top-0 start-0 m-2">Désactivé</span>
  {% endif %}
  <div class="card-body d-flex flex-column">
    <h5 class="card-title small fw-bold">{{ product.name }}</h5>
    <p class="card-text text-muted small mb-2">{{ product.description }}</p>
    <div class="mt-auto d-flex align-items-center justify-content-between">
      <div class="fw-bold">{{ "%.2f"|format((product.price_cents or 0) / 100) }} €</div>
      <div class="d-flex gap-1">
        {% if product.active %}
          <form method="post"
                action="{{ url_for('cart.add', product_id=product.id) }}"
                hx-post="{{ url_for('cart.add', product_id=product.id) }}"
                hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}'
                hx-target="#cart-count"
                hx-swap="outerHTML"
                hx-on="htmx:afterRequest: showAddedToast()"
                class="d-inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button class="btn btn-sm btn-outline-primary" type="submit">Ajouter</button>
          </form>
        {% else %}
          <button class="btn btn-sm btn-outline-secondary" disabled>Désactivé</button>
        {% endif %}
        <a class="btn btn-sm btn-primary" href="{{ url_for('catalog.product_detail', product_id=product.id) }}">Voir</a>
      </div>
    </div>
  </div>
</div>
