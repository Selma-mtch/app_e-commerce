{% extends 'base.html' %}
{% block title %}{{ product.name }} — MaBoutique{% endblock %}
{% block content %}
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card">
        <img src="{{ product.image_url or url_for('static', filename='img/default-product.jpg') }}" class="card-img-top" alt="{{ product.name }}">
      </div>
    </div>
    <div class="col-md-6">
      <h3 class="mb-2">{{ product.name }}</h3>
      <p class="text-muted small">Référence : {{ product.id }}</p>
      <div class="h4 text-primary mb-3">{{ "%.2f"|format(product.price_cents/100) }} €</div>
      <p>{{ product.description }}</p>
      {% if current_user.is_authenticated and current_user.is_admin and not product.active %}
        <span class="badge bg-secondary mb-3">Désactivé</span>
      {% endif %}

      <!-- Formulaire HTMX d'ajout au panier -->
      {% if product.active %}
        <form 
          hx-post="{{ url_for('cart.add', product_id=product.id) }}"
          hx-headers='{"X-CSRFToken": "{{ csrf_token() }}"}'
          hx-target="#cart-count"
          hx-swap="outerHTML"
          hx-on="htmx:afterRequest: showAddedToast()"
          class="d-flex gap-2"
        >
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <input type="number" name="quantity" id="qty" class="form-control w-25" value="1" min="1">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-cart-plus"></i> Ajouter au panier
          </button>
        </form>
      {% else %}
        <div class="alert alert-warning">Ce produit est désactivé et ne peut pas être ajouté au panier.</div>
      {% endif %}

      <hr>
      <small class="text-muted">Livraison estimée: 2-4 jours</small>
    </div>
  </div>
{% endblock %}
